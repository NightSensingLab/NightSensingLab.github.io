---
import BaseLayout from '~/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const publications = await getCollection('publications');
const projects = await getCollection('projects');
const news = await getCollection('news');

// 获取特色论文（最多6篇）
const featuredPublications = publications
  .filter(p => p.data.featured)
  .sort((a, b) => b.data.year - a.data.year)
  .slice(0, 6);

// 获取最新新闻（最多5条）
const latestNews = news
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 5);

// 获取进行中的项目
const ongoingProjects = projects.filter(p => p.data.status === 'ongoing');
---

<BaseLayout title="NightSensingLab - 夜间城市环境监测实验室">
  <div class="container-page py-12">
    <!-- Hero Section -->
    <section class="mb-20 text-center relative">
      <div class="absolute inset-0 bg-gradient-to-r from-brand-600/20 via-purple-600/20 to-blue-600/20 blur-3xl -z-10"></div>
      <h1 class="mb-6 text-5xl font-bold tracking-tight md:text-7xl gradient-text animate-fade-in-up">
        NightSensingLab
      </h1>
      <p class="mx-auto max-w-3xl text-xl text-neutral-600 dark:text-neutral-300 md:text-2xl leading-relaxed animate-fade-in-up">
        专注于夜间城市环境监测的学术实验室，致力于通过先进传感技术和人工智能方法，
        为智慧城市建设提供科学依据和技术支撑。
      </p>
      <div class="mt-8 flex justify-center gap-4 animate-fade-in-up">
        <a href="/publications" class="btn-primary">查看论文</a>
        <a href="/about" class="btn-secondary">了解更多</a>
      </div>
    </section>

    <!-- Latest News -->
    <section class="mb-20">
      <div class="mb-8 flex items-center justify-between">
        <h2 class="text-3xl font-bold gradient-text">最新动态</h2>
        <a href="/news" class="text-brand-400 hover:text-brand-300 font-medium transition-colors duration-300 hover:scale-105 inline-block">查看更多 →</a>
      </div>
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {latestNews.map((item, index) => (
          <article class="card card-hover p-6 group" style={`animation-delay: ${index * 0.1}s`}>
            <div class="mb-3 flex items-center gap-2">
              <div class="w-2 h-2 bg-brand-500 rounded-full"></div>
              <span class="text-sm text-brand-400 font-medium">{item.data.date}</span>
              {item.data.featured && (
                <span class="px-2 py-1 text-xs bg-brand-500/20 text-brand-300 rounded-full">重要</span>
              )}
            </div>
            <h3 class="mb-3 font-semibold text-lg group-hover:text-brand-600 dark:group-hover:text-brand-300 transition-colors duration-300">{item.data.title}</h3>
            <p class="text-sm text-neutral-600 dark:text-neutral-400 leading-relaxed">{item.data.excerpt}</p>
          </article>
        ))}
      </div>
    </section>

    <!-- Featured Publications -->
    <section class="mb-20">
      <div class="mb-8 flex items-center justify-between">
        <h2 class="text-3xl font-bold gradient-text">代表论文</h2>
        <a href="/publications" class="text-brand-400 hover:text-brand-300 font-medium transition-colors duration-300 hover:scale-105 inline-block">查看更多 →</a>
      </div>
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {featuredPublications.map((pub, index) => (
          <article class="card card-hover p-6 group" style={`animation-delay: ${index * 0.1}s`}>
            <div class="mb-3 flex items-center justify-between">
              <span class="text-sm text-brand-400 font-medium">{pub.data.venue} {pub.data.year}</span>
              {pub.data.featured && (
                <span class="px-2 py-1 text-xs bg-brand-500/20 text-brand-300 rounded-full">推荐</span>
              )}
            </div>
            <h3 class="mb-3 font-semibold text-lg leading-tight group-hover:text-brand-600 dark:group-hover:text-brand-300 transition-colors duration-300">{pub.data.title}</h3>
            <p class="mb-4 text-sm text-neutral-600 dark:text-neutral-400">{pub.data.authors.join(', ')}</p>
            <div class="mb-4 flex flex-wrap gap-2">
              {pub.data.tags.slice(0, 3).map((tag) => (
                <span class="rounded-full bg-gradient-to-r from-brand-500/20 to-blue-500/20 px-3 py-1 text-xs text-brand-300 border border-brand-500/30">
                  {tag}
                </span>
              ))}
            </div>
            <div class="flex gap-3">
              {pub.data.doi && (
                <a href={`https://doi.org/${pub.data.doi}`} target="_blank" rel="noopener" 
                   class="text-xs text-brand-400 hover:text-brand-300 hover:scale-110 transition-all duration-300">DOI</a>
              )}
              {pub.data.pdf && (
                <a href={pub.data.pdf} target="_blank" rel="noopener" 
                   class="text-xs text-brand-400 hover:text-brand-300 hover:scale-110 transition-all duration-300">PDF</a>
              )}
              {pub.data.code && (
                <a href={pub.data.code} target="_blank" rel="noopener" 
                   class="text-xs text-brand-400 hover:text-brand-300 hover:scale-110 transition-all duration-300">Code</a>
              )}
            </div>
          </article>
        ))}
      </div>
    </section>

    <!-- Ongoing Projects -->
    <section class="mb-20">
      <div class="mb-8 flex items-center justify-between">
        <h2 class="text-3xl font-bold gradient-text">在研项目</h2>
        <a href="/projects" class="text-brand-400 hover:text-brand-300 font-medium transition-colors duration-300 hover:scale-105 inline-block">查看更多 →</a>
      </div>
      <div class="grid gap-8 md:grid-cols-2">
        {ongoingProjects.map((project, index) => (
          <article class="card card-hover p-8 group" style={`animation-delay: ${index * 0.2}s`}>
            <div class="mb-4 flex items-center gap-3">
              <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
              <span class="text-sm text-green-400 font-medium">进行中</span>
            </div>
            <h3 class="mb-4 text-xl font-semibold group-hover:text-brand-600 dark:group-hover:text-brand-300 transition-colors duration-300">{project.data.title}</h3>
            <p class="mb-6 text-neutral-700 dark:text-neutral-300 leading-relaxed">{project.data.description}</p>
            <div class="mb-6 flex flex-wrap gap-2">
              {project.data.tags.map((tag) => (
                <span class="rounded-full bg-gradient-to-r from-green-500/20 to-brand-500/20 px-3 py-1 text-xs text-green-300 border border-green-500/30">
                  {tag}
                </span>
              ))}
            </div>
            <div class="text-sm text-neutral-600 dark:text-neutral-400">
              <span class="font-medium text-neutral-700 dark:text-neutral-300">成员:</span> {project.data.members.join(', ')}
            </div>
          </article>
        ))}
      </div>
    </section>
  </div>
</BaseLayout>
