---
import BaseLayout from '~/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const people = await getCollection('people');

// 按角色分组，并在每个角色内按displayOrder排序
const groupedPeople = {
  PI: people.filter(p => p.data.role === 'PI').sort((a, b) => a.data.displayOrder - b.data.displayOrder),
  Postdoc: people.filter(p => p.data.role === 'Postdoc').sort((a, b) => a.data.displayOrder - b.data.displayOrder),
  PhD: people.filter(p => p.data.role === 'PhD').sort((a, b) => a.data.displayOrder - b.data.displayOrder),
  Master: people.filter(p => p.data.role === 'Master').sort((a, b) => a.data.displayOrder - b.data.displayOrder),
  Graduate: people.filter(p => p.data.role === 'Graduate').sort((a, b) => a.data.displayOrder - b.data.displayOrder),
  Alumni: people.filter(p => p.data.role === 'Alumni').sort((a, b) => a.data.displayOrder - b.data.displayOrder),
};

const roleLabels = {
  PI: 'Principal Investigator',
  Postdoc: 'Postdoctoral Researchers',
  PhD: 'PhD Students',
  Master: 'Master Students',
  Graduate: 'Graduate Students',
  Alumni: 'Alumni',
};
---

<BaseLayout title="People - NightSensingLab">
  <div class="container-page py-12">
    <div class="mb-8">
      <h1 class="mb-4 text-3xl font-bold">People</h1>
      <p class="text-neutral-400">实验室成员和研究团队</p>
    </div>

    {Object.entries(groupedPeople).map(([role, members]) => {
      if (members.length === 0) return null;
      
      return (
        <section class="mb-16">
          <h2 class="mb-8 text-2xl font-bold">{roleLabels[role as keyof typeof roleLabels]}</h2>
          <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
            {members.map((person) => (
              <article class="card p-6 text-center hover:scale-105 transition-transform cursor-pointer group">
                <a href={`/people/${person.slug}`} class="block">
                  {person.data.avatar ? (
                    <div class="mb-4">
                      <img src={person.data.avatar} alt={person.data.name} 
                           class="mx-auto h-24 w-24 rounded-full object-cover" />
                    </div>
                  ) : (
                    <div class="mb-4 mx-auto h-24 w-24 rounded-full bg-neutral-800 flex items-center justify-center">
                      <span class="text-2xl font-semibold text-neutral-400">
                        {person.data.name.charAt(0)}
                      </span>
                    </div>
                  )}
                  <h3 class="mb-2 text-lg font-semibold group-hover:text-brand-300 transition-colors">{person.data.name}</h3>
                  <p class="mb-2 text-sm text-brand-400">{person.data.role}</p>
                  <p class="mb-4 text-sm text-neutral-600 dark:text-neutral-400">{person.data.affiliation}</p>
                  {person.data.bio && (
                    <p class="mb-4 text-sm text-neutral-600 dark:text-neutral-300 line-clamp-3">{person.data.bio}</p>
                  )}
                  {person.data.researchInterests.length > 0 && (
                    <div class="mb-4">
                      <h4 class="mb-2 text-sm font-medium text-neutral-700 dark:text-neutral-200">研究兴趣</h4>
                      <div class="flex flex-wrap justify-center gap-1">
                        {person.data.researchInterests.slice(0, 3).map((interest) => (
                          <span class="rounded-full bg-neutral-200 dark:bg-neutral-800 px-2 py-1 text-xs text-neutral-700 dark:text-neutral-300">
                            {interest}
                          </span>
                        ))}
                        {person.data.researchInterests.length > 3 && (
                          <span class="rounded-full bg-neutral-200 dark:bg-neutral-800 px-2 py-1 text-xs text-neutral-500 dark:text-neutral-400">
                            +{person.data.researchInterests.length - 3}
                          </span>
                        )}
                      </div>
                    </div>
                  )}
                  <div class="text-sm text-brand-400 group-hover:text-brand-300 transition-colors">
                    查看详情 →
                  </div>
                </a>
              </article>
            ))}
          </div>
        </section>
      );
    })}
  </div>
</BaseLayout>
